!function(){"use strict";function a(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}}function b(a){return Math.round(100*a)/100}function c(a){return Math.round(10*a)/10}function d(a,b){return a>b?a:b}function e(a,b){return b>a?a:b}function f(a){return a-2*a}function g(a,b,c){return a>c?a:c>b?b:c}function h(a,b){return Math.floor(Math.random()*(b-a)+a)}function i(a,b){return Math.random()*(b-a)+a}function j(a){return Math.PI*a/180}function k(a){return a*(Math.PI/180)}function l(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return window.christmasClient.util.currentLang=e.substring(b.length,e.length),e.substring(b.length,e.length)}return null}var m={mobile:window.Modernizr.touch,webGl:a(),click:"",wechat:!1},n={roundTwo:b,roundOne:c,minVal:d,maxVal:e,betweenVal:g,randomVal:h,randomValNoRound:i,radToDeg:j,degToRad:k,invertVal:f,readCookie:l};window.christmasClient=m,window.christmasClient.util=n,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()}(),function(){"use strict";function a(){this.container=document.getElementById("canvasWrapper"),this.camera=new d.PerspectiveCamera(35,window.innerWidth/window.innerHeight,.1,1e4),this.camera.position.y=29,this.camera.position.z=110,this.camera.rotation.x=-.15,this.controls=!1,this.scene=new d.Scene,this.globalGroup=new d.Group,this.light=new d.AmbientLight(7566195),this.sunLight=!1,this.sunSphere=!1,this.moonLight=!1,this.moonSphere=!1,this.scene.add(this.light),this.sky=!1,this.skyNight=!1,this.uniforms=!1,this.nightUniforms=!1,this.landGroup=!1;var c=130,f=130;this.lightsObjectsArray=[],this.allObjectsArray=[],this.renderer=!1,this.composer=!1,this.experienceSupported=!1,window.christmasClient.webGl&&(this.experienceSupported=!0,this.renderer=new d.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.shadowMap.enabled=!0),a.prototype.init=function(){window.christmasClient.webGl?(this.createLights(),this.createLand(),this.createTrees(),this.createHouses(),this.renderScene(2),b()):(e.to(".loader",1,{alpha:0,delay:1}),$(".nowebgl-fallback").addClass("active"),$(".instructions").addClass("hide"))},a.prototype.createLights=function(){this.sunLight=new d.SpotLight(16573385,2,3e3),this.sunLight.position.z=-400,this.sunLight.castShadow=!0,this.sunLight.shadowDarkness=.25,this.sunLight.shadowMapWidth=1024,this.sunLight.shadowMapHeight=600,this.sunLight.shadowCameraNear=1,this.sunLight.shadowCameraFar=4e3,this.sunLight.shadowCameraFov=30,this.moonLight=new d.SpotLight(1908261,5,3e3),this.moonLight.position.z=-400,this.moonLight.castShadow=!0,this.moonLight.shadowDarkness=.75,this.moonLight.shadowMapWidth=1024,this.moonLight.shadowMapHeight=600,this.moonLight.shadowCameraNear=1,this.moonLight.shadowCameraFar=4e3,this.moonLight.shadowCameraFov=30,this.sunSphere=new d.Mesh(new d.SphereGeometry(15,16,16),new d.MeshBasicMaterial({color:16770193})),this.sunSphere.position.z=-400,this.moonSphere=new d.Mesh(new d.SphereGeometry(15,16,16),new d.MeshBasicMaterial({color:16645611})),this.moonSphere.position.z=-400,this.scene.add(this.sunSphere),this.scene.add(this.moonSphere),this.scene.add(this.sunLight),this.scene.add(this.moonLight)},a.prototype.createLand=function(){this.landGroup=new d.Group;for(var a=new d.RingGeometry(0,90,140,40,0,6.3),b=a.vertices.length,c=0;b>c;c++)a.vertices[c].z=window.christmasClient.util.randomValNoRound(0,.8);var e=new d.Mesh(a,new d.MeshLambertMaterial({color:13954556,side:d.DoubleSide}));e.receiveShadow=!0,e.castShadow=!0;var f=new d.Mesh(new d.RingGeometry(0,90,12,1,0,8),new d.MeshLambertMaterial({color:13954556,side:d.DoubleSide}));f.position.z=.5,this.landGroup.add(e),this.landGroup.add(f),this.landGroup.rotation.x=Math.PI/2;var g=document.getElementById("vertexShader").textContent,h=document.getElementById("fragmentShader").textContent;this.uniforms={topColor:{type:"c",value:new d.Color(30719)},bottomColor:{type:"c",value:new d.Color(16777215)},offset:{type:"f",value:33},alpha:{type:"f",value:1},exponent:{type:"f",value:.6}},this.nightUniforms={topColor:{type:"c",value:new d.Color(1031)},bottomColor:{type:"c",value:new d.Color(4647)},offset:{type:"f",value:33},alpha:{type:"f",value:1},exponent:{type:"f",value:.6}};var i=new d.SphereGeometry(2e3,4,2),j=new d.ShaderMaterial({vertexShader:g,fragmentShader:h,uniforms:this.uniforms,side:d.BackSide});this.sky=new d.Mesh(i,j);var k=new d.SphereGeometry(2e3,4,2),l=new d.ShaderMaterial({vertexShader:g,fragmentShader:h,uniforms:this.nightUniforms,side:d.BackSide,transparent:!0});this.skyNight=new d.Mesh(k,l),this.globalGroup.add(this.sky),this.globalGroup.add(this.skyNight),this.globalGroup.add(this.landGroup)},a.prototype.createTrees=function(){for(var a=350,b=new d.CylinderGeometry(.01,.4,.7,3),e=new d.MeshLambertMaterial({color:1579032}),g=new d.Geometry,h=!1,i=0;a>i;i++)for(var j=window.christmasClient.util.randomVal(-c/2,c/2),k=window.christmasClient.util.randomVal(-f/2,f/2),l=0;3>l;l++){var m=new d.Mesh(b,e);m.position.x=j,m.position.z=k,m.position.y=.5*l,m.updateMatrix(),g.merge(m.geometry,m.matrix)}h=new d.Mesh(g,e),this.globalGroup.add(h)},a.prototype.createHouses=function(){for(var a=40,b=new d.BoxGeometry(.75,.65,.8),e=new d.CylinderGeometry(.1,.7,.6,4),g=new d.MeshPhongMaterial({color:8026746}),h=new d.Geometry,i=!1,j=new d.Geometry,k=!1,l=0;a>l;l++){var m=window.christmasClient.util.randomVal(-c/2.5,c/2.5),n=window.christmasClient.util.randomVal(-f/2.5,f/2.5),o=new d.Mesh(b,g);o.position.x=m,o.position.z=n,o.updateMatrix(),h.merge(o.geometry,o.matrix);var p=new d.Mesh(e,g);p.position.x=m,p.position.z=n,p.position.y=.6,p.updateMatrix(),j.merge(p.geometry,p.matrix);var q=new d.PointLight(16748879,3,2.6);q.position.x=m,q.position.z=n,q.position.y=.3,this.globalGroup.add(q)}i=new d.Mesh(h,g),k=new d.Mesh(j,g),this.globalGroup.add(i),this.globalGroup.add(k)},a.prototype.renderScene=function(a){this.scene.add(this.globalGroup);var b=a?a:window.devicePixelRatio;this.renderer.autoClear=!1,this.renderer.setPixelRatio(b),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.appendChild(this.renderer.domElement),e.to(".loader",1,{alpha:0,delay:2,onComplete:function(){$(".loader").remove()}}),setTimeout(function(){p=!0,$(".audio-bg").get(0).play()},2200)},a.prototype.resizeCanvas=function(){this.renderer&&(this.camera.aspect=$(window).width()/$(window).height(),this.camera.updateProjectionMatrix(),this.renderer.setSize($(window).width(),$(window).height()))}}function b(){window.requestAnimationFrame(b),c()}function c(){p&&(f.x=.1*(225*Math.cos(j)-f.x)+f.x,f.y=.1*(225*Math.sin(j)-100-f.y)+f.y,g.x=.1*(225*Math.cos(j+Math.PI)-g.x)+g.x,g.y=.1*(225*Math.sin(j+Math.PI)-100-g.y)+g.y,h.alphaDay=.1*(k-h.alphaDay)+h.alphaDay,h.alphaNight=.1*(l-h.alphaNight)+h.alphaNight,i.cameraPos=.1*(m-i.cameraPos)+i.cameraPos,i.sceneRot=.1*(j/2-i.sceneRot)+i.sceneRot,window.myWebglManager.sunLight.position.x=f.x,window.myWebglManager.sunLight.position.y=f.y,window.myWebglManager.sunSphere.position.x=f.x,window.myWebglManager.sunSphere.position.y=f.y,window.myWebglManager.moonLight.position.x=g.x,window.myWebglManager.moonLight.position.y=g.y,window.myWebglManager.moonSphere.position.x=g.x,window.myWebglManager.moonSphere.position.y=g.y,window.myWebglManager.uniforms.alpha.value=h.alphaDay,window.myWebglManager.nightUniforms.alpha.value=h.alphaNight,window.myWebglManager.camera.position.y=i.cameraPos,window.myWebglManager.globalGroup.rotation.y=i.sceneRot),window.myWebglManager.renderer.render(window.myWebglManager.scene,window.myWebglManager.camera)}var d=window.THREE,e=window.TweenMax,f={x:0,y:0},g={x:0,y:0},h={alphaDay:0,alphaNight:0},i={cameraPos:29,sceneRot:0,lightIntensity:0},j=-Math.PI/3.5,k=0,l=(Math.cos(j+Math.PI/2)+1)/2,m=29,n=-Math.PI/3.5,o=-Math.PI/3.5,p=!1;if(window.myWebglManager=new a,window.myWebglManager.resizeCanvas(),window.myWebglManager.init(),window.myWebglManager.experienceSupported){$(window).on("resize",function(){window.myWebglManager.resizeCanvas()});var q=!1,r=!0;$(window).on("mousedown",function(a){q=!0,n=a.clientX/400-o}),$(window).on("mousemove",function(a){q&&(r&&(r=!1,e.to(".instructions",1,{alpha:0})),j=a.clientX/400-n,k=(Math.cos(-j+Math.PI/2)+1)/2,l=(Math.cos(j+Math.PI/2)+1)/2,m=7*Math.cos(j/1.5)+23)}),$(window).on("mouseup",function(){q=!1,o=j})}}();